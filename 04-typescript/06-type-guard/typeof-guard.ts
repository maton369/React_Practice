// ✅ このコードは TypeScript における
// - unknown 型（中身が分からない値）
// - typeof によるランタイム型ガード（絞り込み / narrowing）
// を使って、安全に string 専用メソッド（split）を呼ぶ例である。
//
// アルゴリズム的には：
// 1) foo は unknown として受け取る（何が入っているか分からない前提）
// 2) 実行時に typeof foo === 'string' をチェックする
// 3) true の分岐内だけ、foo を string として扱える（型が絞られる）
// 4) そのため split(',') が安全に呼べる
// 5) 分岐外では unknown のままなので split は呼べず、コンパイル時に拒否される

// ------------------------------------------------------------
// 1) unknown：値は入っているが型としては “不明” として扱う
// ------------------------------------------------------------
const foo: unknown = '1,2,3,4';
/*
  ✅ unknown の意味：
  - 「どんな型の値でも代入できる」
  - しかし「使うときは検証しないといけない」
    → 例えば foo.split(...) のようなプロパティアクセスは原則できない

  any と違い、unknown は “安全側” の型で、
  検証なしの操作をコンパイラが止めてくれる。
*/

// ------------------------------------------------------------
// 2) typeof による型ガード：ランタイムで string かどうか判定する
// ------------------------------------------------------------
if (typeof foo === 'string') {
    /*
      ✅ この if 条件は JavaScript の実行時チェック。
      そして TypeScript はこの条件を理解し、
      このブロック内では foo の型を string に絞り込む。
  
      これを型の絞り込み（narrowing）という。
    */

    // ----------------------------------------------------------
    // 3) string と確定した範囲でのみ split が呼べる
    // ----------------------------------------------------------
    console.log(foo.split(','));
    /*
      ✅ split(',') の動作：
      - '1,2,3,4' を ',' で区切って配列にする
      - 結果：['1', '2', '3', '4']
  
      ✅ 型的にも：
      - foo は string と確定しているので split が存在する
      - 戻り値は string[] と推論される
    */
}

// ------------------------------------------------------------
// 4) 分岐外：foo は unknown のままなので split は呼べない
// ------------------------------------------------------------
// console.log(foo.split(','));
/*
  ❌ ここは TypeScript 的に不正（型エラーになるのが正しい）：
  - if の外では foo の型は unknown のまま
  - unknown には split というメソッドがある保証がない
  - そのため “検証せずに呼ぶな” とコンパイラが止める

  ✅ もし外でも使いたいなら：
  - もう一度 typeof でチェックする
  - あるいは関数にして型ガードを共通化する
  - あるいは unknown を適切な型へ変換・検証してから保持する
*/